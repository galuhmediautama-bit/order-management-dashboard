# üìã ORDER MANAGEMENT DASHBOARD - TECH STACK & ARCHITECTURE INFO

## üèóÔ∏è TECHNOLOGY STACK

### Frontend
- **Framework:** React 19.2
- **Language:** TypeScript 5.8
- **Build Tool:** Vite 6.2 (HMR, lightning-fast builds)
- **Styling:** Tailwind CSS (utility-first, inline classes)
- **Routing:** React Router 6 (HashRouter for client-side routing)
- **State Management:** React Context API (no Redux)
  - SettingsContext (global app settings)
  - LanguageContext (i18n - Indonesian/English)
  - ToastContext (notifications/alerts)
  - RolePermissionsContext (user permissions)
  - DialogContext (modal management)
  - NotificationCountContext (order/cart counts)

### Backend
- **Database:** Supabase (PostgreSQL)
- **Authentication:** Supabase Auth (session-based)
- **Storage:** Supabase Storage (file uploads)
- **Real-time:** Supabase Realtime (WebSocket subscriptions)
- **API:** PostgreSQL REST API (auto-generated by Supabase)

### UI/Charting
- **Charts:** Recharts (bar, line, pie charts)
- **Icons:** Custom SVG components in `components/icons/`
- **Animations:** Tailwind CSS animations + CSS transitions

### Development Tools
- **Package Manager:** npm
- **Version Control:** Git
- **Deployment:** DigitalOcean App Platform
- **CI/CD:** GitHub Actions (.github/workflows/)

---

## üìÅ PROJECT STRUCTURE

```
order-management-dashboard/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                    # Root component, auth flow, routes
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx                   # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ firebase.ts                # Supabase client config (singleton)
‚îÇ   ‚îú‚îÄ‚îÄ types.ts                   # Central TypeScript definitions
‚îÇ   ‚îú‚îÄ‚îÄ utils.ts                   # Helper functions
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx             # Top navigation bar
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx            # Left menu navigation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ThemeToggle.tsx         # Dark/light mode
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ icons/                 # SVG icon components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BellIcon.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MenuIcon.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (20+ icons)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ landing/               # Landing page components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RolePermissionManager.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (other components)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsContext.tsx      # Global app settings
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LanguageContext.tsx      # i18n translations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ToastContext.tsx         # Toast notifications
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RolePermissionsContext.tsx # User roles/permissions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DialogContext.tsx        # Modal state
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationCountContext.tsx # Order/cart notifications
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OrdersPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CustomersPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductsPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FormEditorPage.tsx       # Order form builder
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FormViewerPage.tsx       # Public form display
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EarningsPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfilePage.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (15+ pages, all lazy-loaded)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (Tailwind CSS only, no CSS files)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ vite-env.d.ts
‚îÇ
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ (static assets)
‚îÇ
‚îú‚îÄ‚îÄ .env.local                       # Environment variables (local)
‚îú‚îÄ‚îÄ vite.config.ts                   # Vite configuration
‚îú‚îÄ‚îÄ tsconfig.json                    # TypeScript config
‚îú‚îÄ‚îÄ tailwind.config.js               # Tailwind CSS config
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ package-lock.json
‚îî‚îÄ‚îÄ .github/
    ‚îî‚îÄ‚îÄ workflows/
        ‚îî‚îÄ‚îÄ deploy.yml               # GitHub Actions CI/CD
```

---

## üóÑÔ∏è DATABASE SCHEMA (SUPABASE)

### Main Tables

**orders**
- `id`, `customer`, `customerPhone`, `customerEmail`
- `status` (Pending/Processing/Shipped/Delivered/Canceled)
- `formId`, `productId`, `brandId`
- `csCommission`, `advCommission` (dual commission system)
- `assignedCsId` (customer service assigned)
- `totalPrice`, `shippingCost`, `codFee`
- `date`, `deletedAt`, `scheduledDeletionDate`

**forms** (landing page builder)
- `id`, `identifier` (UUID or slug)
- `title`, `description`
- `productVariants[]` (JSON array with commission rates)
- `csAssignmentMode` (single/round_robin)
- `trackingPixels` (Meta, Google, TikTok, Snack)
- `thankYouPage` (summary or redirect)
- `createdAt`, `updatedAt`

**users**
- `id`, `email`, `full_name`
- `role` (Super Admin/Admin/Keuangan/CS/Advertiser/Partner)
- `status` (Aktif/Tidak Aktif)
- `assignedBrandIds[]` (for advertisers)
- `assignedCsId` (for CS assignments)
- `avatar`, `phone`

**abandoned_carts**
- `id`, `customerName`, `customerEmail`
- `items[]` (JSON array of cart items)
- `totalAmount`
- `timestamp`, `recovered` (boolean)

**ad_campaigns**
- `id`, `brandId`, `campaignName`
- `impressions`, `clicks`, `conversions`
- `spend`, `revenue`

**settings**
- `key`, `value` (JSON)
- Global site settings, tracking pixels, branding

---

## üîë KEY ARCHITECTURAL PATTERNS

### 1. Authentication Flow
```
HashRouter
  ‚Üì
App.tsx checks auth status
  ‚Üì
supabase.auth.getSession()
  ‚Üì
IF not authenticated ‚Üí LoginPage
IF user.status != 'Aktif' ‚Üí PendingUsersPage
IF authenticated ‚Üí AuthenticatedApp (sidebar + pages)
```

### 2. Lazy Loading Pattern
```typescript
const lazyWithRetry = (componentImport) =>
  React.lazy(async () => {
    try { return await componentImport(); }
    catch (error) {
      await new Promise(r => setTimeout(r, 1000));
      return await componentImport(); // Retry
    }
  });

// Usage
const DashboardPage = lazyWithRetry(() => import('./pages/DashboardPage'));
```

### 3. Context for Global State
```typescript
// SettingsContext
const settings = await supabase.from('settings').select('*');
// Fetched once at app load, cached in context

// LanguageContext  
const t = (key) => translations[language][key];
// Used everywhere: t('dashboard.title')

// ToastContext
showToast('Success!', 'success');
// Modal toast appears at top-right
```

### 4. Supabase Client Pattern
```typescript
// firebase.ts (singleton)
export const supabase = createClient(url, key);

// Used everywhere
import { supabase } from '../firebase';
const { data } = await supabase.from('orders').select('*');
```

### 5. Real-time Subscriptions
```typescript
supabase
  .channel('orders-realtime')
  .on('postgres_changes', { 
    event: 'INSERT', 
    schema: 'public', 
    table: 'orders' 
  }, payload => {
    console.log('New order:', payload.new);
    setOrders(prev => [payload.new, ...prev]);
  })
  .subscribe();
```

### 6. Form Builder Architecture
```
FormEditorPage (visual builder)
  ‚Üì
Save to forms table
  ‚Üì
FormViewerPage (public access via /f/:identifier)
  ‚Üì
User fills form
  ‚Üì
Create order in orders table
  ‚Üì
Snapshot commission from variant settings
```

### 7. Commission System
```
Order created with variant selection
  ‚Üì
Read commission from variant settings
  ‚Üì
Save as snapshot: csCommission + advCommission
  ‚Üì
On order shipped/delivered:
  - CS commission paid if assignedCsId exists
  - Advertiser commission paid if brandId matches
```

---

## üé® STYLING APPROACH

### Tailwind CSS (Utility-First)
- **No CSS files** - all styling via className
- **Dark mode support** - `dark:` prefix classes
- **Color scheme:**
  - Primary: Indigo-600
  - Secondary: Slate grays
  - Accents: Red, Green, Amber, Purple

### Example Component
```tsx
<div className="bg-white dark:bg-slate-800 rounded-lg shadow-md p-4">
  <h1 className="text-xl font-bold text-slate-900 dark:text-white">
    Title
  </h1>
  <p className="text-sm text-slate-600 dark:text-slate-400">
    Description
  </p>
</div>
```

---

## üîê AUTHENTICATION & AUTHORIZATION

### Roles
1. **Super Admin** - Full system access
2. **Admin** - Dashboard + settings
3. **Keuangan** - Finance/commission tracking
4. **Customer Service** - Order management
5. **Advertiser** - View own forms + earnings
6. **Partner** - Limited dashboard access

### Role-Based Access
```typescript
const allowedRoles = ['Super Admin', 'Admin'];
if (!allowedRoles.includes(user.role)) {
  return <AccessDenied />;
}
```

### User Status
- **Aktif** - Can access dashboard
- **Tidak Aktif** - Pending approval, redirected to approval page

---

## üì± KEY FEATURES

### 1. Order Management
- Create/edit/delete orders
- Track status changes
- Assign to customer service
- Dual commission system
- Soft delete with scheduled hard delete

### 2. Form Builder
- Visual form editor (drag-drop style)
- Multiple product variants
- Commission per variant
- CS assignment modes
- Countdown timers
- Social proof popups
- Tracking pixel integration
- Thank you page customization

### 3. Analytics
- Order dashboard
- Commission reports
- Ad campaign performance
- Customer analytics
- Revenue tracking

### 4. Multi-tenancy
- Brand-based filtering
- User role assignments
- Brand-specific settings
- Isolated data views

### 5. Internationalization (i18n)
- Indonesian (id) - default
- English (en)
- Context-based translation system

### 6. Real-time Updates
- New orders appear instantly
- Status changes propagate
- Commission updates live
- No manual refresh needed

---

## üöÄ DEPLOYMENT

### Build Process
```bash
npm run build
# Output: dist/ folder
# Optimized for production
```

### Deployment Platform
- **Primary:** DigitalOcean App Platform
- **Staging:** Optional preview environment
- **CI/CD:** GitHub Actions automatic deployment

### Environment Variables
```
VITE_SUPABASE_URL=https://...
VITE_SUPABASE_ANON_KEY=...
GEMINI_API_KEY=... (for AI features)
```

---

## üîÑ DEVELOPMENT WORKFLOW

### Local Development
```bash
npm install
npm run dev
# Vite dev server on http://localhost:3000
# HMR enabled - instant updates
```

### Type Checking
```bash
npx tsc --noEmit
# Verify TypeScript without building
```

### Building
```bash
npm run build
# Compiles to dist/
# Ready for deployment
```

---

## üìä DATA FLOW EXAMPLE

### Creating an Order
```
User fills form (FormViewerPage)
  ‚Üì
Validate data
  ‚Üì
supabase.from('orders').insert([{...}])
  ‚Üì
Real-time: INSERT event triggered
  ‚Üì
OrdersPage: notification appears
  ‚Üì
Header: order count updated
  ‚Üì
Customer Service: can view in OrdersPage
  ‚Üì
Assign to CS, set status
  ‚Üì
Real-time: UPDATE event triggered
  ‚Üì
Dashboard: charts update
```

---

## üîó API INTEGRATION

### Supabase REST API
```typescript
// Auto-generated from PostgreSQL schema
GET /rest/v1/orders
POST /rest/v1/orders
PATCH /rest/v1/orders?id=eq.{id}
DELETE /rest/v1/orders?id=eq.{id}
```

### Real-time WebSocket
```typescript
// Automatic row-level subscriptions
supabase.channel('table:orders').subscribe()
// Filters: INSERT, UPDATE, DELETE events
```

---

## üì¶ DEPENDENCIES

### Core
- react 19.2
- typescript 5.8
- vite 6.2
- react-router 6

### UI/Styling
- tailwindcss
- (custom SVG icons)

### Data
- @supabase/supabase-js
- recharts

### Utilities
- date handling (native JS)
- translation (custom Context)

---

## ‚ö° PERFORMANCE OPTIMIZATIONS

1. **Code Splitting:** All pages lazy-loaded
2. **Memoization:** useMemo for expensive calculations
3. **Pagination:** Large lists paginated (orders, customers)
4. **Caching:** Global settings cached in Context
5. **Real-time:** WebSocket for instant updates (no polling)
6. **Build:** Vite for fastest dev experience
7. **Tree-shaking:** Unused code removed in production

---

## üîí SECURITY

### Authentication
- Supabase session-based auth
- JWT tokens in HTTP-only cookies
- Password hashing (Supabase managed)

### Authorization
- Role-based access control
- Row-level security (RLS) on database
- User status validation

### Data Protection
- All sensitive data in database
- No API keys exposed to client
- Supabase handles encryption

---

## üìù BEST PRACTICES USED

1. **TypeScript Everywhere** - Strong typing prevents bugs
2. **Single Responsibility** - Each component does one thing
3. **Context Over Props Drilling** - Global state management
4. **Lazy Loading** - Better initial load time
5. **Error Boundaries** - Graceful error handling
6. **Dark Mode** - Accessibility + user preference
7. **i18n Ready** - Multi-language support
8. **Responsive Design** - Works on all screen sizes
9. **Accessible** - ARIA labels, semantic HTML
10. **DRY Principle** - No repeated code

---

## üéØ FOR YOUR CUSTOM PROMPTS

Use this structure when asking for:

### Feature Requests
"Based on the tech stack (React + TypeScript + Tailwind + Supabase), I want to..."

### Bug Reports
"In [ComponentName].tsx, [describe issue]. Using [tech stack], here's what happened..."

### Architecture Questions
"For [feature], should I use [approach]? Current system uses Context API for state..."

### Deployment
"Need to deploy to [platform]. Using Vite build + DigitalOcean..."

### Performance
"Page [name] is slow. Using React + Recharts + real-time subscriptions..."

### Database
"Need query for [requirement]. Using Supabase PostgreSQL with RLS policies..."

---

**This document describes the current production system as of December 7, 2025.**
